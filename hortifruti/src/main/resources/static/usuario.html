<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Cadastro de Usuários</title>

<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
	crossorigin="anonymous">

</head>
<body class="container mt-5">

	<a href="index.html" class="btn btn-outline-secondary mb-3">← Voltar</a>

	<h1 class="mb-4">CADASTRO DE FUNCIONÁRIOS:</h1>

	<!-- Bootstrap JS -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
		crossorigin="anonymous"></script>
	
	<!-- Formulário de Cadastro -->
	<form id="formUsuario" class="mb-2 mb-md-4 mb-lg-5">
		<div class="row g-3 mb-2 mb-md-3 mb-lg-4">
			<div class="col-12 col-sm-6 col-md-2 col-lg-2">
				<input type="text" class="form-control" id="id" readonly
					placeholder="ID automático">
			</div>

			<div class="col-12 col-sm-6 col-md-2 col-lg-3">
				<input type="text" id="nome" class="form-control" placeholder="Nome"
					required>
			</div>

			<div class="col-12 col-sm-6 col-md-2 col-lg-3">
				<input type="text" id="sobrenome" class="form-control"
					placeholder="Sobrenome" required>
			</div>

			<div class="col-12 col-sm-6 col-md-2 col-lg-2">
				<select id="sexo" class="form-select" required>
					<option value="">Selecione o sexo</option>
					<option value="Masculino">Masculino</option>
					<option value="Feminino">Feminino</option>
				</select>
			</div>

			<div class="col-12 col-sm-6 col-md-2 col-lg-2">
				<input type="number" id="idade" class="form-control"
					placeholder="Idade" required>
			</div>

			<div class="col-12 col-sm-6 col-md-2 col-lg-2">
				<input type="text" id="cpf" class="form-control" placeholder="CPF"
					maxlength="14" required>
			</div>

			<div class="col-12 col-sm-6 col-md-2 col-lg-2">
				<input type="text" id="rg" class="form-control" placeholder="RG"
					maxlength="12" required>
			</div>

			<div class="col-12 col-sm-6 col-md-3 col-lg-3">
			
				<input type="date" id="dataNascimento" class="form-control"
					placeholder="Data de Nascimento" required>
			</div>

			<div class="row mt-2 mt-md-3">
				<div class="col-12 d-grid gap-2 d-md-flex justify-content-md-start">
					<button type="button" class="btn btn-primary"
						onclick="salvarUsuario()">Salvar</button>
					<button type="button" class="btn btn-secondary"
						onclick="document.getElementById('formUsuario').reset();">Novo</button>
					<button type="button" class="btn btn-success"
						data-bs-toggle="modal" data-bs-target="#modalPesquisar">Pesquisar</button>
					<button type="button" class="btn btn-danger"
						onclick="botaoDeletarTelaInicial()">Deletar</button>
				</div>

				<!-- MODAL -->
				<div class="modal fade" id="modalPesquisar" tabindex="-1"
					aria-labelledby="exampleModalLabel" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered modal-lg">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title">Buscar por Usuário</h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal"
									aria-label="Close"></button>
							</div>
							<div class="modal-body">
								<form>
									<div class="mb-2 mb-md-3">
										<label for="nomeBuscar" class="col-form-label">Nome:</label> <input
											type="text" class="form-control" id="nomeBuscar">
									</div>
									<div
										class="d-grid d-md-flex justify-content-md-start mb-2 mb-md-3">
										<button type="button" class="btn btn-success"
											onclick="buscarUsuario()">Buscar</button>
									</div>
								</form>
								<div id="divTabelaDados"></div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary"
									data-bs-dismiss="modal">Fechar</button>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
	</form>

	<!-- TABELA -->
	<div id="divTabelaDados" class="table-responsive mt-3 mt-md-4"
		style="max-height: 60vh; overflow-y: auto;">
		<table class="table table-striped" id="tabelaDados">
			<thead class="table-light">
				<tr>
					<th>ID</th>
					<th>Nome</th>
					<th>Sobrenome</th>
					<th>Sexo</th>
					<th>Idade</th>
					<th>CPF</th>
					<th>RG</th>
					<th>Data Nasc.</th>
					<th>Ações</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
	</div>

	<!-- jQuery -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

	<script type="text/javascript">
	function salvarUsuario() {

		var id = $("#id").val();
		var nome = $("#nome").val();
		var sobrenome = $("#sobrenome").val();
		var sexo = $("#sexo").val();
		var idade = $("#idade").val();
		var cpf = $("#cpf").val();
		var rg = $("#rg").val();
		var dataNascimento = $("#dataNascimento").val();

		if (nome == null || nome.trim() == '') {
			$("#nome").focus();
			alert("Informe o nome do usuário!");
			return;
		}

		if (sobrenome == null || sobrenome.trim() == '') {
			$("#sobrenome").focus();
			alert("Informe o sobrenome do usuário!");
			return;
		}

		if (sexo == null || sexo.trim() == '') {
			$("#sexo").focus();
			alert("Informe o sexo do usuário!");
			return;
		}

		if (idade == null || idade.trim() == '') {
			$("#idade").focus();
			alert("Informe a idade do usuário!");
			return;
		}

		if (cpf == null || cpf.trim() == '') {
			$("#cpf").focus();
			alert("Informe o CPF do usuário!");
			return;
		}

		if (rg == null || rg.trim() == '') {
			$("#rg").focus();
			alert("Informe o RG do usuário!");
			return;
		}

		if (dataNascimento == null || dataNascimento.trim() == '') {
			$("#dataNascimento").focus();
			alert("Informe a data de nascimento do usuário!");
			return;
		}

		$.ajax({
			method : "POST",
			url : "usuario/salvar",
			data : JSON.stringify({
				id : id,
				nome : nome,
				sobrenome : sobrenome,
				sexo : sexo,
				idade : idade,
				cpf : cpf,
				rg : rg,
				dataNascimento : dataNascimento
			}),
			contentType : "application/json; charset=utf-8",
			success : function(response) {
				$("#id").val(response.id);
				alert("Dados cadastrados com sucesso!");
			}
		}).fail(function(xhr) {
			alert("Erro ao salvar: " + xhr.responseText);
		});
	}

	function buscarUsuario() {
		var nome = $("#nomeBuscar").val();
		if (nome != null && nome.trim() != '') {
			$.ajax({
				method : "GET",
				url : "usuario/buscarPeloNome",
				data : "nome=" + nome,
				success : function(response) {
					$("#tabelaDados > tbody > tr").remove();
					$("#modalPesquisar").modal("hide");

					for (var i = 0; i < response.length; i++) {
						$("#tabelaDados > tbody").append(
							"<tr id='idLinha'>" +
							"<td>" + response[i].id + "</td>" +
							"<td>" + response[i].nome + "</td>" +
							"<td>" + response[i].sobrenome + "</td>" +
							"<td>" + response[i].sexo + "</td>" +
							"<td>" + response[i].idade + "</td>" +
							"<td>" + response[i].cpf + "</td>" +
							"<td>" + response[i].rg + "</td>" +
							"<td>" + (response[i].dataNascimento || '') + "</td>" +
							"<td>" +
							"<button type='button' class='btn btn-primary btn-sm me-2' onclick='colocarEmEdicao(" + response[i].id + ")'>Editar</button>" +
							"<button type='button' class='btn btn-danger btn-sm' onclick='deletarUsuario(" + response[i].id + ")'>Deletar</button>" +
							"</td>" +
							"</tr>"
						);
					}
				}
			}).fail(function(xhr) {
				alert("Erro ao buscar: " + xhr.responseText);
			});
		}
	}

	function colocarEmEdicao(id) {
		$.ajax({
			method : "GET",
			url : "usuario/buscarPorId",
			data : "id=" + id,
			success : function(response) {
				$("#id").val(response.id);
				$("#nome").val(response.nome);
				$("#sobrenome").val(response.sobrenome);
				$("#sexo").val(response.sexo);
				$("#idade").val(response.idade);
				$("#cpf").val(response.cpf);
				$("#rg").val(response.rg);
				$("#dataNascimento").val(response.dataNascimento);
			}
		}).fail(function(xhr) {
			alert("Erro ao buscar usuário!" + xhr.responseText);
		});
	}

	function deletarUsuario(id) {
		if (confirm("Deseja mesmo deletar?")) {
			$.ajax({
				method : "DELETE",
				url : "usuario/deletar",
				data : "id=" + id,
				success : function(response) {
					alert(response);
					$('#idLinha').remove();
				}
			}).fail(function(xhr) {
				alert("Erro ao deletar!" + xhr.responseText);
			});
		}
	}

	function botaoDeletarTelaInicial() {
		var id = $("#id").val();
		if (id != null && id.trim() != '') {
			deletarUsuario(id);
			document.getElementById('formUsuario').reset();
		} else {
			alert("Não há nenhum usuário a ser deletado!");
		}
	}
	</script>

	<!-- Máscara RG -->
	<script>
	$(document).ready(function() {
		$("#rg").on("input", function() {
			let rg = $(this).val().replace(/\D/g, '');
			if (rg.length > 9) rg = rg.substring(0, 9);
			if (rg.length > 5) {
				rg = rg.replace(/(\d{2})(\d{3})(\d{1,3})/, "$1.$2.$3");
			} else if (rg.length > 2) {
				rg = rg.replace(/(\d{2})(\d{1,3})/, "$1.$2");
			}
			$(this).val(rg);
		});
	});
	</script>

	<!-- Máscara CPF -->
	<script>
	$(document).ready(function() {
		$("#cpf").on("input", function() {
			var cpf = $(this).val().replace(/\D/g, '');
			cpf = cpf.substring(0, 11);
			if (cpf.length > 9) {
				cpf = cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/, "$1.$2.$3-$4");
			} else if (cpf.length > 6) {
				cpf = cpf.replace(/(\d{3})(\d{3})(\d{1,3})/, "$1.$2.$3");
			} else if (cpf.length > 3) {
				cpf = cpf.replace(/(\d{3})(\d{1,3})/, "$1.$2");
			}
			$(this).val(cpf);
		});
	});
	</script>

</body>
</html>
